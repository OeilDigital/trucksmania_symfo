{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
<div class="container">
<hr>
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 80%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
        #macarte{
            height:60vh;
            width: 50vw;
        }
</style>

<div class="example-wrapper">
    <h4 style="font-family: 'Gloria Hallelujah', cursive;"> Bienvenue à tous sur TrucksMania, le seul site qui vous permet de découvrir
    les meilleurs foodtrucks prés de chez vous.<br> Si vous souhaitez voir les Foodtrucks présents à proximité de vous autorisez votre geolocalisation.</h4>
    <button onclick="getLocation()">Géolocalisez-moi</button>

    <p id="demo"></p>

    <div id="macarte">

    </div>

</div>
{% endblock %}
{% block javascripts %}
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""></script>
    <script>

        var x = document.getElementById("demo");
        //geolocalisation du visiteur
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            } else { 
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function showPosition(position) {
            let latitude = position.coords.latitude; 
            let longitude = position.coords.longitude;
            
            // Tableau de geoloc/trucks-test(factices)
            var trucks = {
                "Truck1": {"lat": 43.599933817437666, "lon": 3.860247949410145 },
                "Truck2": {"lat": 43.5951901200623, "lon": 3.8672780328201832 },
            };


            // On initialise la carte
            var carte = L.map('macarte').setView([latitude, longitude], 15);

            //On charge les tuiles
            L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
                    // Il est toujours bien de laisser le lien vers la source des données
                    attribution: 'données © <a href="//osm.org/copyright">OpenStreetMap</a>/ODbL - rendu <a href="//openstreetmap.fr">OSM France</a>',
                    minZoom: 1,
                    maxZoom: 20
                }).addTo(carte);

            for (truck in trucks){
            var markerT = L.marker([trucks[truck].lat, trucks[truck].lon]).addTo(carte);
            markerT.bindPopup("<h6>"+truck+"</h6>").openPopup();
            }

            var marker = L.marker([latitude, longitude]).addTo(carte);
            marker.bindPopup("<h6>Salut à toi!</h6>").openPopup();

        }
    </script>  
{% endblock %}